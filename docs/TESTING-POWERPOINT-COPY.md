# PowerPointコピー機能 - 動作確認手順

## 🎯 実装完了！

PowerPointへのテーブルコピー機能が実装されました（v0.1.2）

## 📝 実装内容

### 追加された機能

1. **📋 TSVコピーボタン**
   - タブ区切りテキストとしてコピー
   - PowerPoint、Excel、Wordで使用可能
   - シンプルで軽量、確実に動作

2. **📋 HTMLコピーボタン**
   - スタイル付きHTMLとしてコピー
   - 色、太字、数値フォーマットを保持
   - 条件付きスタイリング（赤字・太字など）も保持

### 変更されたファイル

- `src/databaseClientPanel.ts`:
  - UIにコピーボタンを追加
  - `copyTableAsTSV()` 関数を実装
  - `copyTableAsHTML()` 関数を実装
  - `generateColumnStyleForClipboard()` 関数を実装
  - クエリ実行後にボタンを表示するロジック追加

- `package.json`:
  - バージョンを 0.1.2 に更新

- `CHANGELOG.md`:
  - v0.1.2 の変更内容を記載

- `README.md`:
  - クリップボードコピー機能を説明

- `docs/POWERPOINT-COPY-GUIDE.md`:
  - 詳細なユーザーガイドを作成

## 🧪 動作確認手順

### 1. 拡張機能をリロード

1. VS Code/Cursorで `F5` キーを押す（デバッグモード起動）
2. 新しいウィンドウが開く（Extension Development Host）

### 2. QueryCanvasを開く

1. `Cmd+Shift+P` (Mac) / `Ctrl+Shift+P` (Windows)
2. "QueryCanvas: Open Database Client" を実行

### 3. データベースに接続

1. 接続プロファイルを選択
2. 「接続」ボタンをクリック

### 4. テストクエリを実行

#### テスト1: 基本的なコピー（スタイルなし）

```sql
SELECT 
    '東京店' AS 店舗名,
    1234567 AS 売上,
    98.5 AS 達成率,
    NOW() AS 更新日時
UNION ALL
SELECT 
    '大阪店',
    2345678,
    105.2,
    NOW()
UNION ALL
SELECT 
    '福岡店',
    -123456,
    78.3,
    NOW();
```

**確認事項:**
- ✅ 実行結果が表示される
- ✅ 結果の上部に「📋 TSVコピー」「📋 HTMLコピー」ボタンが表示される

#### テスト2: スタイル付きコピー（条件付きスタイリング）

```sql
/**
 * @column 店舗名 width=150px
 * @column 売上 type=int align=right format=number comma=true if<0:color=red,bold=true if>2000000:color=green,bold=true
 * @column 達成率 type=float align=right format=number decimal=1 if<80:color=red if>=100:color=green,bold=true
 * @column 更新日時 format=datetime pattern=yyyy/MM/dd_HH:mm
 */
SELECT 
    '東京店' AS 店舗名,
    1234567 AS 売上,
    98.5 AS 達成率,
    NOW() AS 更新日時
UNION ALL
SELECT 
    '大阪店',
    2345678,
    105.2,
    NOW()
UNION ALL
SELECT 
    '福岡店',
    -123456,
    78.3,
    NOW();
```

**確認事項:**
- ✅ 売上がカンマ区切りで表示される（1,234,567）
- ✅ マイナスの売上が赤字・太字で表示される
- ✅ 200万超の売上が緑色・太字で表示される
- ✅ 80未満の達成率が赤字で表示される
- ✅ 100以上の達成率が緑色・太字で表示される

### 5. TSVコピーをテスト

1. 「📋 TSVコピー」ボタンをクリック
2. 成功メッセージが表示される
3. PowerPointを開く（または任意のテキストエディタ）
4. `Cmd+V` (Mac) / `Ctrl+V` (Windows) で貼り付け

**期待される結果:**
```
店舗名	売上	達成率	更新日時
東京店	1234567	98.5	2025-12-28T...
大阪店	2345678	105.2	2025-12-28T...
福岡店	-123456	78.3	2025-12-28T...
```

**PowerPointでの確認:**
- ✅ テーブルとして貼り付けられる
- ✅ 3行のデータが表示される
- ❌ スタイル（色・太字）は保持されない（TSVなので正常）

### 6. HTMLコピーをテスト

1. 「📋 HTMLコピー」ボタンをクリック
2. 成功メッセージが表示される
3. PowerPointを開く
4. `Cmd+V` (Mac) / `Ctrl+V` (Windows) で貼り付け

**期待される結果（PowerPoint）:**
- ✅ テーブルとして貼り付けられる
- ✅ ヘッダーが青色の背景（#4472C4）で表示される
- ✅ データ行が交互に白/グレー背景で表示される
- ✅ 売上列が右寄せで表示される
- ✅ マイナスの売上（-123,456）が**赤字・太字**で表示される
- ✅ 200万超の売上（2,345,678）が**緑色・太字**で表示される
- ✅ 80未満の達成率（78.3）が**赤字**で表示される
- ✅ 100以上の達成率（105.2）が**緑色・太字**で表示される
- ✅ カンマ区切りの数値フォーマットが保持される

### 7. Excel/Wordでもテスト

同じ手順で、ExcelやWordにも貼り付けてみてください。

**期待される結果:**
- ✅ Excelでもスタイルが保持される
- ✅ Wordでもスタイルが保持される

## 📊 期待される画面イメージ

### QueryCanvas内の表示

```
┌─────────────────────────────────────────────────────────┐
│ 実行結果            [📋 TSVコピー] [📋 HTMLコピー]       │
├─────────────────────────────────────────────────────────┤
│ ┌─────────┬─────────────┬──────────┬───────────────┐   │
│ │ 店舗名   │      売上    │  達成率  │   更新日時    │   │
│ ├─────────┼─────────────┼──────────┼───────────────┤   │
│ │ 東京店   │  1,234,567  │   98.5   │ 2025/12/28... │   │
│ │ 大阪店   │  2,345,678  │  105.2   │ 2025/12/28... │   │
│ │          │  (緑・太字)  │(緑・太字)│               │   │
│ │ 福岡店   │   -123,456  │   78.3   │ 2025/12/28... │   │
│ │          │  (赤・太字)  │ (赤字)   │               │   │
│ └─────────┴─────────────┴──────────┴───────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### PowerPointに貼り付けた後

同じスタイルが保持される！

## 🐛 トラブルシューティング

### ボタンが表示されない

**原因:** コンパイルエラーまたは実装ミス

**確認:**
```bash
cd /Users/okuyama/Documents/projects/vsex001
npm run compile
```

エラーがないか確認してください。

### HTMLコピーが上手くいかない

**原因:** ブラウザのClipboard API制限

**解決策:**
1. TSVコピーを使用（確実に動作）
2. Chromeベースのブラウザで試す
3. PowerPoint側で「形式を選択して貼り付け」→「HTML」を選択

### スタイルが反映されない

**原因1:** TSVコピーを使った（スタイルなし）
→ HTMLコピーを使用してください

**原因2:** PowerPointのバージョンが古い
→ 最新版のPowerPointを使用してください

**原因3:** 表示オプションが正しく指定されていない
→ `type=int` などの型指定を追加してください

## ✅ 成功の判定基準

以下がすべて確認できればOKです：

- [ ] TSVコピーボタンが表示される
- [ ] HTMLコピーボタンが表示される
- [ ] TSVコピーでPowerPointに貼り付けできる
- [ ] HTMLコピーでPowerPointに貼り付けできる
- [ ] HTMLコピーで色・太字が保持される
- [ ] 条件付きスタイリング（赤字・緑色）が保持される
- [ ] カンマ区切りのフォーマットが保持される
- [ ] 日時フォーマットが適用される

## 📝 次のステップ

動作確認が完了したら：

1. ✅ TODOを完了にマーク
2. 📦 VSIXパッケージをビルド（オプション）
3. 🚀 VS Code Marketplaceに公開（オプション）
4. 📢 ユーザーにアナウンス

## 🎉 完成！

これで、QueryCanvasからPowerPointへのシームレスなデータ移行が可能になりました！

---

**実装者メモ:**
- 実装日: 2025-12-28
- バージョン: 0.1.2
- 実装ファイル: `src/databaseClientPanel.ts`
- ドキュメント: `docs/POWERPOINT-COPY-GUIDE.md`

